# Сбор и Обогащение Данных о Людях с помощью LLM

Этот проект представляет собой консольную утилиту для автоматизированного сбора, обработки, анализа и экспорта данных о людях. Процесс включает в себя подготовку и очистку данных, обогащение информации с помощью больших языковых моделей (LLM), поиск дополнительной информации через интернет, проверки качества данных и экспорт результатов в удобные форматы.

---

## Основные возможности

* **Подготовка базы данных:** Очистка исходных данных и создание рабочих таблиц.
* **Предварительная обработка (PreLLM):** Нормализация и очистка имен, фамилий, описаний перед обработкой LLM.
* **Обогащение данных с помощью LLM:** Извлечение структурированной информации о персоне (имя, фамилия, описание).
* **Поиск дополнительной информации (Perplexity):** Автоматический поиск в интернете для нахождения ссылок и описаний.
* **Проверка качества данных (PostCheck1 и PostCheck2):** Проверка валидности summary через LLM, с учетом контекста персоны.
* **Обработка фотографий:** Сбор изображений с найденных ссылок, фильтрация по лицам и кластеризация по сходству.
* **Экспорт результатов:** Сохранение данных в единый HTML-отчет.

---

## Подготовка

1. Клонируйте репозиторий:

```bash
git clone <URL_репозитория>
cd <папка_проекта>
```

2. Установите зависимости:

```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` с настройками базы данных и LLM:

```
DB_HOST=
DB_NAME=
DB_USER=
DB_PASSWORD=
DB_PORT=
OPENROUTER_API_KEY=
LLM_URL=
```

---

## Использование

Запуск основного скрипта:

```bash
python main.py --help
```

Вывод справки:

```text
Pipeline Manager for People Processing

options:
  -h, --help          show this help message and exit
  --dbcreate          Очистить и пересоздать таблицы
  --tasks             Заполнить очередь задач
  --run <count>       Запустить указанное количество воркеров
  --stats             Показать статистику по этапам
  --html            Экспортировать результаты в HTML
```

Примеры команд:

```bash
python main.py --dbcreate
python main.py --tasks
python main.py --run 5
python main.py --stats
python main.py --export
```

---

## Структура пайплайна

1. **PreLLM:** очистка и нормализация данных.
2. **LLM:** извлечение meaningful_first_name, meaningful_last_name и meaningful_about.
3. **Perplexity:** поиск информации и генерация summary, сбор URL и confidence.
4. **PostCheck1:** проверка валидности summary.
5. **PostCheck2:** проверка summary с учетом контекста персоны.
6. **HTML Export:** объединение результатов в единый отчет.

---

## Логирование

* **INFO** — вывод в консоль.
* **DEBUG и выше** — сохраняются в файл `logs/app.log`.
* Каждое действие воркера логируется с указанием `worker_id` и `person_id`.
